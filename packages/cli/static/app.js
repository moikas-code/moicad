import{useState as o,useCallback as y2}from"react";import{createRoot as M2}from"react-dom/client";import Y2,{forwardRef as x1,useRef as q1,useImperativeHandle as g1,useState as H1,useCallback as i,createContext as v2,useEffect as T1,useMemo as A2,useContext as B2}from"react";import{jsx as X,jsxs as B,Fragment as O2}from"react/jsx-runtime";function V1(J,Q){(Q==null||Q>J.length)&&(Q=J.length);for(var $=0,K=Array(Q);$<Q;$++)K[$]=J[$];return K}function s1(J){if(Array.isArray(J))return J}function e1(J,Q,$){return(Q=T0(Q))in J?Object.defineProperty(J,Q,{value:$,enumerable:!0,configurable:!0,writable:!0}):J[Q]=$,J}function J0(J,Q){var $=J==null?null:typeof Symbol<"u"&&J[Symbol.iterator]||J["@@iterator"];if($!=null){var K,T,q,Z,U=[],Y=!0,W=!1;try{if(q=($=$.call(J)).next,Q===0);else for(;!(Y=(K=q.call($)).done)&&(U.push(K.value),U.length!==Q);Y=!0);}catch(I){W=!0,T=I}finally{try{if(!Y&&$.return!=null&&(Z=$.return(),Object(Z)!==Z))return}finally{if(W)throw T}}return U}}function Q0(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function D1(J,Q){var $=Object.keys(J);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(J);Q&&(K=K.filter(function(T){return Object.getOwnPropertyDescriptor(J,T).enumerable})),$.push.apply($,K)}return $}function W1(J){for(var Q=1;Q<arguments.length;Q++){var $=arguments[Q]!=null?arguments[Q]:{};Q%2?D1(Object($),!0).forEach(function(K){e1(J,K,$[K])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors($)):D1(Object($)).forEach(function(K){Object.defineProperty(J,K,Object.getOwnPropertyDescriptor($,K))})}return J}function I1(J,Q){if(J==null)return{};var $,K,T=$0(J,Q);if(Object.getOwnPropertySymbols){var q=Object.getOwnPropertySymbols(J);for(K=0;K<q.length;K++)$=q[K],Q.indexOf($)===-1&&{}.propertyIsEnumerable.call(J,$)&&(T[$]=J[$])}return T}function $0(J,Q){if(J==null)return{};var $={};for(var K in J)if({}.hasOwnProperty.call(J,K)){if(Q.indexOf(K)!==-1)continue;$[K]=J[K]}return $}function k1(J,Q){return s1(J)||J0(J,Q)||q0(J,Q)||Q0()}function K0(J,Q){if(typeof J!="object"||!J)return J;var $=J[Symbol.toPrimitive];if($!==void 0){var K=$.call(J,Q);if(typeof K!="object")return K;throw TypeError("@@toPrimitive must return a primitive value.")}return(Q==="string"?String:Number)(J)}function T0(J){var Q=K0(J,"string");return typeof Q=="symbol"?Q:Q+""}function q0(J,Q){if(J){if(typeof J=="string")return V1(J,Q);var $={}.toString.call(J).slice(8,-1);return $==="Object"&&J.constructor&&($=J.constructor.name),$==="Map"||$==="Set"?Array.from(J):$==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test($)?V1(J,Q):void 0}}function H0(J,Q,$){if(Q in J)Object.defineProperty(J,Q,{value:$,enumerable:!0,configurable:!0,writable:!0});else J[Q]=$;return J}function w1(J,Q){var $=Object.keys(J);if(Object.getOwnPropertySymbols){var K=Object.getOwnPropertySymbols(J);if(Q)K=K.filter(function(T){return Object.getOwnPropertyDescriptor(J,T).enumerable});$.push.apply($,K)}return $}function P1(J){for(var Q=1;Q<arguments.length;Q++){var $=arguments[Q]!=null?arguments[Q]:{};if(Q%2)w1(Object($),!0).forEach(function(K){H0(J,K,$[K])});else if(Object.getOwnPropertyDescriptors)Object.defineProperties(J,Object.getOwnPropertyDescriptors($));else w1(Object($)).forEach(function(K){Object.defineProperty(J,K,Object.getOwnPropertyDescriptor($,K))})}return J}function Z0(){for(var J=arguments.length,Q=Array(J),$=0;$<J;$++)Q[$]=arguments[$];return function(K){return Q.reduceRight(function(T,q){return q(T)},K)}}function x(J){return function Q(){var $=this;for(var K=arguments.length,T=Array(K),q=0;q<K;q++)T[q]=arguments[q];return T.length>=J.length?J.apply(this,T):function(){for(var Z=arguments.length,U=Array(Z),Y=0;Y<Z;Y++)U[Y]=arguments[Y];return Q.apply($,[].concat(T,U))}}}function e(J){return{}.toString.call(J).includes("Object")}function U0(J){return!Object.keys(J).length}function g(J){return typeof J==="function"}function X0(J,Q){return Object.prototype.hasOwnProperty.call(J,Q)}function W0(J,Q){if(!e(Q))f("changeType");if(Object.keys(Q).some(function($){return!X0(J,$)}))f("changeField");return Q}function Y0(J){if(!g(J))f("selectorType")}function v0(J){if(!(g(J)||e(J)))f("handlerType");if(e(J)&&Object.values(J).some(function(Q){return!g(Q)}))f("handlersType")}function A0(J){if(!J)f("initialIsRequired");if(!e(J))f("initialType");if(U0(J))f("initialContent")}function B0(J,Q){throw Error(J[Q]||J.default)}var O0={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},f=x(B0)(O0),s={changes:W0,selector:Y0,handler:v0,initial:A0};function G0(J){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};s.initial(J),s.handler(Q);var $={current:J},K=x(D0)($,Q),T=x(V0)($),q=x(s.changes)(J),Z=x(N0)($);function U(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(I){return I};return s.selector(W),W($.current)}function Y(W){Z0(K,T,q,Z)(W)}return[U,Y]}function N0(J,Q){return g(Q)?Q(J.current):Q}function V0(J,Q){return J.current=P1(P1({},J.current),Q),Q}function D0(J,Q,$){return g(Q)?Q(J.current):Object.keys($).forEach(function(K){var T;return(T=Q[K])===null||T===void 0?void 0:T.call(Q,J.current[K])}),$}var I0={create:G0},L1=I0;var C1={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.55.1/min/vs"}};function F1(J){return function Q(){var $=this;for(var K=arguments.length,T=Array(K),q=0;q<K;q++)T[q]=arguments[q];return T.length>=J.length?J.apply(this,T):function(){for(var Z=arguments.length,U=Array(Z),Y=0;Y<Z;Y++)U[Y]=arguments[Y];return Q.apply($,[].concat(T,U))}}}function R1(J){return{}.toString.call(J).includes("Object")}function k0(J){if(!J)b1("configIsRequired");if(!R1(J))b1("configType");if(J.urls)return w0(),{paths:{vs:J.urls.monacoBase}};return J}function w0(){console.warn(y1.deprecation)}function P0(J,Q){throw Error(J[Q]||J.default)}var y1={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},b1=F1(P0)(y1),M1={config:k0};var _1=function(){for(var Q=arguments.length,$=Array(Q),K=0;K<Q;K++)$[K]=arguments[K];return function(T){return $.reduceRight(function(q,Z){return Z(q)},T)}};function Y1(J,Q){return Object.keys(Q).forEach(function($){if(Q[$]instanceof Object){if(J[$])Object.assign(Q[$],Y1(J[$],Q[$]))}}),W1(W1({},J),Q)}var L0={type:"cancelation",msg:"operation is manually canceled"};function J1(J){var Q=!1,$=new Promise(function(K,T){J.then(function(q){return Q?T(L0):K(q)}),J.catch(T)});return $.cancel=function(){return Q=!0},$}var C0=["monaco"],F0=L1.create({config:C1,isInitialized:!1,resolve:null,reject:null,monaco:null}),u1=k1(F0,2),a=u1[0],Q1=u1[1];function R0(J){var Q=M1.config(J),$=Q.monaco,K=I1(Q,C0);Q1(function(T){return{config:Y1(T.config,K),monaco:$}})}function b0(){var J=a(function(Q){var{monaco:$,isInitialized:K,resolve:T}=Q;return{monaco:$,isInitialized:K,resolve:T}});if(!J.isInitialized){if(Q1({isInitialized:!0}),J.monaco)return J.resolve(J.monaco),J1(v1);if(window.monaco&&window.monaco.editor)return z1(window.monaco),J.resolve(window.monaco),J1(v1);_1(y0,_0)(u0)}return J1(v1)}function y0(J){return document.body.appendChild(J)}function M0(J){var Q=document.createElement("script");return J&&(Q.src=J),Q}function _0(J){var Q=a(function(K){var{config:T,reject:q}=K;return{config:T,reject:q}}),$=M0("".concat(Q.config.paths.vs,"/loader.js"));return $.onload=function(){return J()},$.onerror=Q.reject,$}function u0(){var J=a(function($){var{config:K,resolve:T,reject:q}=$;return{config:K,resolve:T,reject:q}}),Q=window.require;Q.config(J.config),Q(["vs/editor/editor.main"],function($){var K=$.m||$;z1(K),J.resolve(K)},function($){J.reject($)})}function z1(J){if(!a().monaco)Q1({monaco:J})}function z0(){return a(function(J){var Q=J.monaco;return Q})}var v1=new Promise(function(J,Q){return Q1({resolve:J,reject:Q})}),h={config:R0,init:b0,__getMonacoInstance:z0};import{memo as E0}from"react";import f0,{useState as E1,useRef as p,useCallback as f1,useEffect as h1}from"react";import{memo as h0}from"react";import A1 from"react";import p0 from"react";import{useEffect as a0}from"react";import{useEffect as i0,useRef as o0}from"react";import{useState as v5}from"react";import{memo as Q2}from"react";import $2,{useState as S1,useEffect as $1,useRef as z,useCallback as K2}from"react";import{useEffect as T2,useRef as q2}from"react";var S0={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}},B1=S0,l0={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},m0=l0;function d0({children:J}){return p0.createElement("div",{style:m0.container},J)}var c0=d0,j0=c0;function x0({width:J,height:Q,isEditorReady:$,loading:K,_ref:T,className:q,wrapperProps:Z}){return A1.createElement("section",{style:{...B1.wrapper,width:J,height:Q},...Z},!$&&A1.createElement(j0,null,K),A1.createElement("div",{ref:T,style:{...B1.fullWidth,...!$&&B1.hide},className:q}))}var g0=x0,p1=h0(g0);function n0(J){a0(J,[])}var l1=n0;function t0(J,Q,$=!0){let K=o0(!0);i0(K.current||!$?()=>{K.current=!1}:J,Q)}var _=t0;function n(){}function l(J,Q,$,K){return r0(J,K)||s0(J,Q,$,K)}function r0(J,Q){return J.editor.getModel(m1(J,Q))}function s0(J,Q,$,K){return J.editor.createModel(Q,$,K?m1(J,K):void 0)}function m1(J,Q){return J.Uri.parse(Q)}function e0({original:J,modified:Q,language:$,originalLanguage:K,modifiedLanguage:T,originalModelPath:q,modifiedModelPath:Z,keepCurrentOriginalModel:U=!1,keepCurrentModifiedModel:Y=!1,theme:W="light",loading:I="Loading...",options:v={},height:A="100%",width:M="100%",className:u,wrapperProps:y={},beforeMount:F=n,onMount:w=n}){let[D,m]=E1(!1),[d,P]=E1(!0),L=p(null),k=p(null),c=p(null),R=p(w),O=p(F),S=p(!1);l1(()=>{let G=h.init();return G.then((C)=>(k.current=C)&&P(!1)).catch((C)=>C?.type!=="cancelation"&&console.error("Monaco initialization: error:",C)),()=>L.current?j():G.cancel()}),_(()=>{if(L.current&&k.current){let G=L.current.getOriginalEditor(),C=l(k.current,J||"",K||$||"text",q||"");C!==G.getModel()&&G.setModel(C)}},[q],D),_(()=>{if(L.current&&k.current){let G=L.current.getModifiedEditor(),C=l(k.current,Q||"",T||$||"text",Z||"");C!==G.getModel()&&G.setModel(C)}},[Z],D),_(()=>{let G=L.current.getModifiedEditor();G.getOption(k.current.editor.EditorOption.readOnly)?G.setValue(Q||""):Q!==G.getValue()&&(G.executeEdits("",[{range:G.getModel().getFullModelRange(),text:Q||"",forceMoveMarkers:!0}]),G.pushUndoStop())},[Q],D),_(()=>{L.current?.getModel()?.original.setValue(J||"")},[J],D),_(()=>{let{original:G,modified:C}=L.current.getModel();k.current.editor.setModelLanguage(G,K||$||"text"),k.current.editor.setModelLanguage(C,T||$||"text")},[$,K,T],D),_(()=>{k.current?.editor.setTheme(W)},[W],D),_(()=>{L.current?.updateOptions(v)},[v],D);let t=f1(()=>{if(!k.current)return;O.current(k.current);let G=l(k.current,J||"",K||$||"text",q||""),C=l(k.current,Q||"",T||$||"text",Z||"");L.current?.setModel({original:G,modified:C})},[$,Q,T,J,K,q,Z]),r=f1(()=>{!S.current&&c.current&&(L.current=k.current.editor.createDiffEditor(c.current,{automaticLayout:!0,...v}),t(),k.current?.editor.setTheme(W),m(!0),S.current=!0)},[v,W,t]);h1(()=>{D&&R.current(L.current,k.current)},[D]),h1(()=>{!d&&!D&&r()},[d,D,r]);function j(){let G=L.current?.getModel();U||G?.original?.dispose(),Y||G?.modified?.dispose(),L.current?.dispose()}return f0.createElement(p1,{width:M,height:A,isEditorReady:D,loading:I,_ref:c,className:u,wrapperProps:y})}var J2=e0,W5=E0(J2);function H2(J){let Q=q2();return T2(()=>{Q.current=J},[J]),Q.current}var Z2=H2,K1=new Map;function U2({defaultValue:J,defaultLanguage:Q,defaultPath:$,value:K,language:T,path:q,theme:Z="light",line:U,loading:Y="Loading...",options:W={},overrideServices:I={},saveViewState:v=!0,keepCurrentModel:A=!1,width:M="100%",height:u="100%",className:y,wrapperProps:F={},beforeMount:w=n,onMount:D=n,onChange:m,onValidate:d=n}){let[P,L]=S1(!1),[k,c]=S1(!0),R=z(null),O=z(null),S=z(null),t=z(D),r=z(w),j=z(),G=z(K),C=Z2(q),G1=z(!1),Z1=z(!1);l1(()=>{let b=h.init();return b.then((E)=>(R.current=E)&&c(!1)).catch((E)=>E?.type!=="cancelation"&&console.error("Monaco initialization: error:",E)),()=>O.current?r1():b.cancel()}),_(()=>{let b=l(R.current,J||K||"",Q||T||"",q||$||"");b!==O.current?.getModel()&&(v&&K1.set(C,O.current?.saveViewState()),O.current?.setModel(b),v&&O.current?.restoreViewState(K1.get(q)))},[q],P),_(()=>{O.current?.updateOptions(W)},[W],P),_(()=>{!O.current||K===void 0||(O.current.getOption(R.current.editor.EditorOption.readOnly)?O.current.setValue(K):K!==O.current.getValue()&&(Z1.current=!0,O.current.executeEdits("",[{range:O.current.getModel().getFullModelRange(),text:K,forceMoveMarkers:!0}]),O.current.pushUndoStop(),Z1.current=!1))},[K],P),_(()=>{let b=O.current?.getModel();b&&T&&R.current?.editor.setModelLanguage(b,T)},[T],P),_(()=>{U!==void 0&&O.current?.revealLine(U)},[U],P),_(()=>{R.current?.editor.setTheme(Z)},[Z],P);let N1=K2(()=>{if(!(!S.current||!R.current)&&!G1.current){r.current(R.current);let b=q||$,E=l(R.current,K||J||"",Q||T||"",b||"");O.current=R.current?.editor.create(S.current,{model:E,automaticLayout:!0,...W},I),v&&O.current.restoreViewState(K1.get(b)),R.current.editor.setTheme(Z),U!==void 0&&O.current.revealLine(U),L(!0),G1.current=!0}},[J,Q,$,K,T,q,W,I,v,Z,U]);$1(()=>{P&&t.current(O.current,R.current)},[P]),$1(()=>{!k&&!P&&N1()},[k,P,N1]),G.current=K,$1(()=>{P&&m&&(j.current?.dispose(),j.current=O.current?.onDidChangeModelContent((b)=>{Z1.current||m(O.current.getValue(),b)}))},[P,m]),$1(()=>{if(P){let b=R.current.editor.onDidChangeMarkers((E)=>{let U1=O.current.getModel()?.uri;if(U1&&E.find((X1)=>X1.path===U1.path)){let X1=R.current.editor.getModelMarkers({resource:U1});d?.(X1)}});return()=>{b?.dispose()}}return()=>{}},[P,d]);function r1(){j.current?.dispose(),A?v&&K1.set(q,O.current.saveViewState()):O.current.getModel()?.dispose(),O.current.dispose()}return $2.createElement(p1,{width:M,height:u,isEditorReady:P,loading:Y,_ref:S,className:y,wrapperProps:F})}var X2=U2,W2=Q2(X2),d1=W2;import*as H from"three";import{OrbitControls as G2}from"three/examples/jsm/controls/OrbitControls.js";var N2=Object.defineProperty,V2=(J,Q,$)=>(Q in J)?N2(J,Q,{enumerable:!0,configurable:!0,writable:!0,value:$}):J[Q]=$,N=(J,Q,$)=>V2(J,typeof Q!=="symbol"?Q+"":Q,$);var D2=typeof window<"u"&&"__TAURI__"in window,c1=D2?"http://localhost:42069":process.env.NEXT_PUBLIC_API_URL||"http://localhost:42069";async function I2(J,Q,$="javascript",K){let T=Date.now();try{Q?.({stage:"initializing",progress:10,message:"Connecting to backend server."});let q={code:J,language:$};if(K!==void 0)q.t=Math.max(0,Math.min(1,K));let Z=await fetch(`${c1}/api/evaluate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(Q?.({stage:"parsing",progress:30,message:"Parsing your code."}),!Z.ok)throw Error(`Evaluation failed: ${Z.statusText}`);Q?.({stage:"evaluating",progress:60,message:"Generating 3D geometry from code."});let U=await Z.json();return Q?.({stage:"complete",progress:90,message:"Finalizing geometry and preparing for display.",time:Date.now()-T}),U}catch(q){return console.error("Evaluation error:",q),{geometry:null,errors:[{message:q instanceof Error&&q.message.includes("Failed to fetch")?`Could not connect to backend at ${c1}. Is the server running?`:`Failed to evaluate code: ${q instanceof Error?q.message:"Unknown error"}`}],success:!1,executionTime:0}}}var k2=x1(function({code:Q,language:$="javascript",onChange:K,onErrors:T,onGeometry:q,onLoading:Z,onProgress:U,onRenderRequest:Y,onAnimationDetected:W},I){let v=q1({onGeometry:q,onErrors:T,onLoading:Z,onProgress:U,onRenderRequest:Y,onAnimationDetected:W});v.current={onGeometry:q,onErrors:T,onLoading:Z,onProgress:U,onRenderRequest:Y,onAnimationDetected:W};let A=q1(null),M=(F,w)=>{A.current=F,F.addCommand(w.KeyMod.Alt|w.KeyCode.KeyR,()=>{v.current.onRenderRequest?.()}),setTimeout(()=>{F.focus()},100)},u=async(F)=>{if(!v.current.onLoading||!v.current.onGeometry||!v.current.onErrors)return;v.current.onLoading(!0);try{let w=await I2(Q,(D)=>{v.current.onProgress?.(D)},$,F);if(w.success&&w.geometry)v.current.onGeometry(w.geometry),v.current.onErrors(w.errors.map((D)=>D.message));else v.current.onGeometry(null),v.current.onErrors(w.errors.map((D)=>D.message))}catch(w){v.current.onErrors([`Error: ${w instanceof Error?w.message:"Unknown error"}`])}finally{v.current.onLoading(!1)}};g1(I,()=>({render:()=>u(),renderWithT:(F)=>u(F)}));let y=$==="javascript"?"javascript":"cpp";return X("div",{className:"w-full h-full",children:X(d1,{height:"100%",defaultLanguage:y,language:y,value:Q,onChange:(F)=>K(F||""),onMount:M,theme:"vs-dark",options:{minimap:{enabled:!1},fontSize:14,fontFamily:"Fira Code, Monaco, Courier New",lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,formatOnPaste:!0,formatOnType:!0,wordWrap:"on"}})})}),a1=k2,P5=class extends Y2.Component{constructor(J){super(J);N(this,"reset",()=>{this.setState({hasError:!1,error:null})}),this.state={hasError:!1,error:null}}static getDerivedStateFromError(J){return{hasError:!0,error:J}}componentDidCatch(J,Q){console.error("ErrorBoundary caught an error:",J,Q)}render(){if(this.state.hasError){let J=this.props.fallback||w2;return X(J,{error:this.state.error,reset:this.reset})}return this.props.children}};function w2({error:J,reset:Q}){return X("div",{className:"min-h-screen bg-[#1D1D1D] flex items-center justify-center p-4",children:B("div",{className:"bg-[#2D2D2D] border border-[#3D3D3D] rounded-lg p-6 max-w-md w-full",children:[B("div",{className:"flex items-center gap-3 mb-4",children:[X("span",{className:"text-2xl",children:"\uD83D\uDCA5"}),X("h2",{className:"text-lg font-semibold text-white",children:"Something went wrong"})]}),J&&B("div",{className:"mb-4",children:[X("p",{className:"text-sm text-red-400 mb-2",children:"Error details:"}),X("div",{className:"bg-[#1D1D1D] p-3 rounded text-xs text-[#B0B0B0] font-mono break-words",children:J.message})]}),X("button",{onClick:Q,className:"w-full px-4 py-2 bg-[#4772B3] hover:bg-[#5882C3] text-white text-sm rounded transition-colors",children:"Try Again"}),X("p",{className:"text-xs text-[#808080] mt-3 text-center",children:"If the problem persists, try refreshing the page."})]})})}function n1({errors:J,onLineClick:Q}){let $=A2(()=>{if(!J)return[];return J.split(`
`).filter((K)=>K.trim().length>0).map((K,T)=>{let q=K.match(/(?:line|Line)\s*(\d+)/i),Z=q?parseInt(q[1]):null;return{id:T,message:K,line:Z}})},[J]);if($.length===0)return null;return B("div",{className:"bg-red-900 bg-opacity-20 border border-red-700 rounded p-3 space-y-2",children:[B("h3",{className:"text-sm font-semibold text-red-400 flex items-center gap-2",children:[X("span",{children:"⚠️"}),$.length===1?"Error":`${$.length} Errors`]}),X("div",{className:"space-y-1 max-h-48 overflow-y-auto",children:$.map((K)=>B("div",{onClick:()=>K.line&&Q?.(K.line),className:`text-xs text-red-300 flex items-start gap-2 ${K.line?"cursor-pointer hover:text-red-200 transition-colors":""}`,children:[K.line&&B("span",{className:"text-red-500 font-semibold flex-shrink-0",children:[K.line,":"]}),X("span",{className:"break-words flex-1",children:K.message})]},K.id))})]})}var i1="moicad_files",j1="moicad_current_file";function O1(){try{let J=localStorage.getItem(i1);return J?JSON.parse(J):[]}catch(J){return console.error("Failed to load files:",J),[]}}function P2(J){try{let $=O1().filter((K)=>K.id!==J);if(localStorage.setItem(i1,JSON.stringify($)),localStorage.getItem(j1)===J)localStorage.removeItem(j1);return!0}catch(Q){return console.error("Failed to delete file:",Q),!1}}var L2=x1(({onOpen:J,onNew:Q},$)=>{let[K,T]=H1(!1),[q,Z]=H1([]),U=i(()=>{let A=O1();Z(A),T(!0)},[]),Y=i((A)=>{J(A.code),T(!1)},[J]),W=i((A,M)=>{if(M.stopPropagation(),confirm("Are you sure you want to delete this file?"))P2(A),Z(O1())},[]),I=i(()=>{Q(),T(!1)},[Q]),v=i(()=>{let A=document.createElement("input");A.type="file",A.accept=".scad,.csg",A.onchange=async(M)=>{let u=M.target.files?.[0];if(u)try{let y=new FileReader;y.onload=(F)=>{let w=F.target?.result;J(w),T(!1)},y.onerror=()=>{alert("Failed to read file")},y.readAsText(u)}catch(y){console.error("File import error:",y),alert(`Import failed: ${y instanceof Error?y.message:"Unknown error"}`)}},A.click()},[J]);return g1($,()=>({openFileManager:U}),[U]),X(O2,{children:K&&X("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:B("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-6 max-w-lg w-full mx-4",children:[X("h2",{className:"text-lg font-bold text-white mb-4",children:"File Manager"}),B("div",{className:"flex gap-2 mb-4",children:[X("button",{onClick:I,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors font-medium",children:"New File"}),X("button",{onClick:v,className:"flex-1 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded transition-colors font-medium",children:"Import .scad"})]}),X("div",{className:"max-h-96 overflow-y-auto",children:q.length===0?X("p",{className:"text-center text-slate-400 py-8",children:"No saved files"}):X("div",{className:"space-y-2",children:q.map((A)=>B("div",{onClick:()=>Y(A),className:"p-3 bg-slate-700 hover:bg-slate-600 rounded cursor-pointer transition-colors flex justify-between items-start group",children:[B("div",{className:"flex-1 min-w-0",children:[X("h3",{className:"font-semibold text-white truncate",children:A.name}),X("p",{className:"text-xs text-slate-400",children:new Date(A.timestamp).toLocaleString()}),A.description&&X("p",{className:"text-xs text-slate-300 mt-1 truncate",children:A.description})]}),X("button",{onClick:(M)=>W(A.id,M),className:"ml-2 px-2 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:"Delete"})]},A.id))})}),X("button",{onClick:()=>T(!1),className:"w-full px-4 py-2 mt-4 bg-slate-700 hover:bg-slate-600 text-white rounded transition-colors",children:"Cancel"})]})})})});L2.displayName="FileManager";var C2=v2(null);function o1(){let J=B2(C2);if(!J)throw Error("useViewportControls must be used within a ViewportControlsProvider");return J}function F2({geometry:J}){let{showStatsOverlay:Q}=o1();if(!J||!Q||!J.stats||!J.bounds)return null;let{vertexCount:$=0,faceCount:K=0}=J.stats,{min:T=[0,0,0],max:q=[0,0,0]}=J.bounds,Z={x:(q[0]-T[0]).toFixed(2),y:(q[1]-T[1]).toFixed(2),z:(q[2]-T[2]).toFixed(2)};return B("div",{className:"absolute top-4 left-4 bg-[#2D2D2D]/95 backdrop-blur-sm border border-[#3D3D3D] rounded-lg p-3 text-xs text-[#A0A0A0] shadow-lg pointer-events-none",children:[X("div",{className:"font-semibold text-white mb-2",children:"Geometry Stats"}),B("div",{className:"space-y-1",children:[B("div",{className:"flex justify-between gap-4",children:[X("span",{children:"Vertices:"}),X("span",{className:"text-white font-mono",children:$.toLocaleString()})]}),B("div",{className:"flex justify-between gap-4",children:[X("span",{children:"Faces:"}),X("span",{className:"text-white font-mono",children:K.toLocaleString()})]}),X("div",{className:"border-t border-[#3D3D3D] my-2"}),X("div",{className:"font-semibold text-white mb-1",children:"Dimensions"}),B("div",{className:"flex justify-between gap-4",children:[X("span",{children:"W:"}),X("span",{className:"text-white font-mono",children:Z.x})]}),B("div",{className:"flex justify-between gap-4",children:[X("span",{children:"H:"}),X("span",{className:"text-white font-mono",children:Z.y})]}),B("div",{className:"flex justify-between gap-4",children:[X("span",{children:"D:"}),X("span",{className:"text-white font-mono",children:Z.z})]}),X("div",{className:"border-t border-[#3D3D3D] my-2"}),X("div",{className:"font-semibold text-white mb-1",children:"Bounds"}),B("div",{className:"text-[#808080] text-xs font-mono",children:[B("div",{children:["Min: [",T.join(", "),"]"]}),B("div",{children:["Max: [",q.join(", "),"]"]})]})]})]})}var R2=class{constructor(J){N(this,"scene"),N(this,"camera"),N(this,"renderer"),N(this,"controls"),N(this,"gridHelper"),N(this,"axisHelper"),N(this,"edgesHelper",null),N(this,"mesh",null),N(this,"scaleMarkersGroup",null),N(this,"crosshairGroup",null),N(this,"buildVolumeBox",null),N(this,"isPerspective",!0),N(this,"lastGeometryBounds",null),N(this,"geometryObjects",new Map),N(this,"highlightedObjects",new Set),N(this,"selectedObjects",new Set),N(this,"raycaster",new H.Raycaster),N(this,"mouse",new H.Vector2),N(this,"animationId",null),N(this,"onHoverCallback"),N(this,"onSelectCallback"),N(this,"printerSize"),N(this,"animate",()=>{this.animationId=requestAnimationFrame(this.animate),this.controls.update(),this.renderer.render(this.scene,this.camera)});let Q=J.printerSize||{width:256,depth:256,height:300,name:"BambuLab P2S"};this.printerSize=Q,this.scene=new H.Scene,this.scene.background=new H.Color(0);let $=Q.width/2,K=Q.height/2,T=Q.depth/2,Z=Math.max(Q.width,Q.depth,Q.height)*1.5;this.camera=new H.PerspectiveCamera(75,J.width/J.height,0.1,Z*3),this.camera.position.set($+Z*0.7,K+Z*0.7,T+Z),this.camera.lookAt($,K,T),this.renderer=new H.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setSize(J.width,J.height),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=H.PCFShadowMap,J.container.appendChild(this.renderer.domElement),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.display="block",this.setupLighting(),this.controls=new G2(this.camera,this.renderer.domElement),this.controls.target.set($,K,T),this.controls.enableDamping=!0,this.controls.dampingFactor=0.05,this.controls.autoRotate=!1,this.controls.autoRotateSpeed=2,this.setupMouseEvents(),this.gridHelper=new H.GridHelper(Math.max(Q.width,Q.depth),20,16777215,4473924),this.gridHelper.name="grid",this.gridHelper.position.set(Q.width/2,0,Q.depth/2),this.scene.add(this.gridHelper),this.axisHelper=new H.AxesHelper(Math.max(Q.width,Q.depth,Q.height)*0.6),this.axisHelper.name="axes",this.axisHelper.position.set(Q.width/2,0,Q.depth/2),this.scene.add(this.axisHelper),this.addBuildVolumeBox(Q),this.animate(),window.addEventListener("resize",()=>this.onWindowResize(J))}addBuildVolumeBox(J){let Q=new H.BoxGeometry(J.width,J.height,J.depth),$=new H.EdgesGeometry(Q),K=new H.LineBasicMaterial({color:65280,linewidth:2,transparent:!0,opacity:0.3});if(this.buildVolumeBox)this.scene.remove(this.buildVolumeBox),this.buildVolumeBox.geometry.dispose(),this.buildVolumeBox.material.dispose();if(this.buildVolumeBox=new H.LineSegments($,K),this.buildVolumeBox.position.set(J.width/2,J.height/2,J.depth/2),this.buildVolumeBox.name="buildVolume",this.scene.add(this.buildVolumeBox),J.name)this.scene.printerName=J.name}setupLighting(){let J=new H.AmbientLight(16777215,0.6);this.scene.add(J);let Q=new H.DirectionalLight(16777215,0.8);Q.position.set(100,100,100),Q.castShadow=!0,Q.shadow.camera.left=-200,Q.shadow.camera.right=200,Q.shadow.camera.top=200,Q.shadow.camera.bottom=-200,Q.shadow.camera.far=1000,this.scene.add(Q);let $=new H.PointLight(35071,0.3);$.position.set(-50,100,50),this.scene.add($)}renderGeometry(J){if(this.mesh)this.scene.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.material.dispose();let Q=new H.BufferGeometry;if(Q.setAttribute("position",new H.BufferAttribute(new Float32Array(J.vertices),3)),Q.setIndex(new H.BufferAttribute(new Uint32Array(J.indices),1)),J.normals&&J.normals.length>0)Q.setAttribute("normal",new H.BufferAttribute(new Float32Array(J.normals),3));else Q.computeVertexNormals();let $=new H.MeshStandardMaterial({color:8421504,metalness:0.1,roughness:0.5,flatShading:!0,side:H.DoubleSide});if(this.mesh=new H.Mesh(Q,$),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.rotation.x=-Math.PI/2,this.mesh.position.set(this.printerSize.width/2,0,this.printerSize.depth/2),this.scene.add(this.mesh),J.objects&&J.objects.length>0)this.renderGeometryObjects(J.objects);if(J.bounds)this.fitViewToGeometry(J.bounds)}renderGeometryObjects(J){this.clearGeometryObjects(),J.forEach((Q,$)=>{let K=Q.geometry,T=Q.highlight?.objectId||`object_${$}`,q=new H.BufferGeometry;if(q.setAttribute("position",new H.BufferAttribute(new Float32Array(K.vertices),3)),q.setIndex(new H.BufferAttribute(new Uint32Array(K.indices),1)),K.normals&&K.normals.length>0)q.setAttribute("normal",new H.BufferAttribute(new Float32Array(K.normals),3));else q.computeVertexNormals();let Z=this.createObjectMaterial(K,Q),U=new H.Mesh(q,Z);U.userData.objectId=T,U.userData.lineNumber=Q.highlight?.line,U.castShadow=!0,U.receiveShadow=!0,U.rotation.x=-Math.PI/2,U.position.set(this.printerSize.width/2,0,this.printerSize.depth/2),this.geometryObjects.set(T,U),this.scene.add(U)})}createObjectMaterial(J,Q){let $=8421504,K=1,T=!1;if(J.modifier)switch(J.modifier.type){case"#":$=16711680;break;case"%":K=0.5,T=!0;break;case"!":$=65280;break}if(J.color){let q=J.color;if($=new H.Color(q.r,q.g,q.b).getHex(),q.a&&q.a<1)K=q.a,T=!0}if(Q.highlight?.isHovered)$=16776960;if(Q.highlight?.isSelected)$=65535;return new H.MeshStandardMaterial({color:$,metalness:0.1,roughness:0.5,flatShading:!0,side:H.DoubleSide,transparent:T,opacity:K})}clearGeometryObjects(){this.geometryObjects.forEach((J)=>{this.scene.remove(J),J.geometry.dispose(),J.material.dispose()}),this.geometryObjects.clear(),this.highlightedObjects.clear(),this.selectedObjects.clear()}highlightObject(J,Q=!0){let $=this.geometryObjects.get(J);if(!$)return;if(Q)this.highlightedObjects.add(J);else this.highlightedObjects.delete(J);this.updateObjectMaterial($)}selectObject(J,Q=!0){let $=this.geometryObjects.get(J);if(!$)return;if(Q)this.selectedObjects.add(J);else this.selectedObjects.delete(J);this.updateObjectMaterial($)}updateObjectMaterial(J){let Q=J.userData.objectId,$=this.highlightedObjects.has(Q),K=this.selectedObjects.has(Q),T=J.material;if(K)T.emissive=new H.Color(65535),T.emissiveIntensity=0.3;else if($)T.emissive=new H.Color(16776960),T.emissiveIntensity=0.2;else T.emissive=new H.Color(0),T.emissiveIntensity=0}onMouseMove(J){let Q=this.renderer.domElement.getBoundingClientRect();this.mouse.x=(J.clientX-Q.left)/Q.width*2-1,this.mouse.y=-((J.clientY-Q.top)/Q.height)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);let $=Array.from(this.geometryObjects.values()),K=this.raycaster.intersectObjects($);this.highlightedObjects.clear();let T=null;if(K.length>0){let U=K[0].object.userData.objectId;if(U)this.highlightedObjects.add(U),T=U}if($.forEach((q)=>this.updateObjectMaterial(q)),this.onHoverCallback)this.onHoverCallback(T)}onMouseClick(J){let Q=this.renderer.domElement.getBoundingClientRect();this.mouse.x=(J.clientX-Q.left)/Q.width*2-1,this.mouse.y=-((J.clientY-Q.top)/Q.height)*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);let $=Array.from(this.geometryObjects.values()),K=this.raycaster.intersectObjects($);if(K.length>0){let q=K[0].object,Z=q.userData.objectId;if(Z){if(this.selectedObjects.has(Z))this.selectedObjects.delete(Z);else this.selectedObjects.add(Z);if(this.updateObjectMaterial(q),this.onSelectCallback)this.onSelectCallback(Array.from(this.selectedObjects))}}else if(this.selectedObjects.clear(),$.forEach((T)=>this.updateObjectMaterial(T)),this.onSelectCallback)this.onSelectCallback([])}setHoverCallback(J){this.onHoverCallback=J}setSelectCallback(J){this.onSelectCallback=J}getSelectedObjects(){return Array.from(this.selectedObjects)}clearHighlighting(){this.highlightedObjects.clear(),this.selectedObjects.clear(),Array.from(this.geometryObjects.values()).forEach((Q)=>this.updateObjectMaterial(Q))}fitViewToGeometry(J){if(!J||!J.min||!J.max)return;this.lastGeometryBounds=J;let Q=new H.Vector3(this.printerSize.width/2,0,this.printerSize.depth/2),$=new H.Vector3(...J.min).add(Q),K=new H.Vector3(...J.max).add(Q),T=new H.Vector3().addVectors($,K).multiplyScalar(0.5),q=new H.Vector3().subVectors(K,$).length(),Z=this.camera instanceof H.PerspectiveCamera?this.camera.fov:75,U=q/Math.tan(Z*Math.PI/360),Y=new H.Vector3(1,1,1).normalize();this.camera.position.copy(T.clone().add(Y.clone().multiplyScalar(U*1.2))),this.camera.lookAt(T),this.controls.target.copy(T),this.controls.update()}resetView(){if(this.lastGeometryBounds)this.fitViewToGeometry(this.lastGeometryBounds);else{let J=new H.Vector3(this.printerSize.width/2,0,this.printerSize.depth/2),Q=Math.max(this.printerSize.width,this.printerSize.depth)*1.5,$=new H.Vector3(1,1,1).normalize();this.camera.position.copy(J.clone().add($.clone().multiplyScalar(Q))),this.camera.lookAt(J),this.controls.target.copy(J),this.controls.update()}}toggleGrid(J){let Q=J!==void 0?J:!this.gridHelper.visible;this.gridHelper.visible=Q}toggleEdges(J){if(!this.mesh)return;if(J!==void 0?J:!this.edgesHelper){let Q=new H.EdgesGeometry(this.mesh.geometry);this.edgesHelper=new H.LineSegments(Q,new H.LineBasicMaterial({color:0,linewidth:2})),this.edgesHelper.name="edges",this.scene.add(this.edgesHelper)}else if(this.edgesHelper)this.scene.remove(this.edgesHelper),this.edgesHelper.geometry.dispose(),this.edgesHelper.material.dispose(),this.edgesHelper=null}toggleAxes(J){let Q=J!==void 0?J:!this.axisHelper.visible;this.axisHelper.visible=Q}toggleScaleMarkers(J){let Q=J!==void 0?J:!this.scaleMarkersGroup;if(Q&&!this.scaleMarkersGroup){this.scaleMarkersGroup=new H.Group,this.scaleMarkersGroup.name="scaleMarkers",this.scaleMarkersGroup.position.set(this.printerSize.width/2,0,this.printerSize.depth/2);let $={x:new H.LineBasicMaterial({color:16711680}),y:new H.LineBasicMaterial({color:65280}),z:new H.LineBasicMaterial({color:255})},K=50,T=[[-K,0,0],[K,0,0],[0,-K,0],[0,K,0],[0,0,-K],[0,0,K]];T.forEach((q,Z)=>{if(Z%2===0){let U=T[Z+1],Y=new H.BufferGeometry().setFromPoints([new H.Vector3(...q),new H.Vector3(...U)]),W=Math.floor(Z/2),I=$[W],v=new H.Line(Y,I);if(this.scaleMarkersGroup)this.scaleMarkersGroup.add(v)}}),this.scene.add(this.scaleMarkersGroup)}else if(!Q&&this.scaleMarkersGroup)this.scene.remove(this.scaleMarkersGroup),this.scaleMarkersGroup.traverse(($)=>{if($ instanceof H.Line)$.geometry.dispose(),$.material.dispose()}),this.scaleMarkersGroup=null}toggleCrosshair(J){let Q=J!==void 0?J:!this.crosshairGroup;if(Q&&!this.crosshairGroup){this.crosshairGroup=new H.Group,this.crosshairGroup.name="crosshair";let $=20,K=new H.BufferGeometry().setFromPoints([new H.Vector3(-$,0,0),new H.Vector3($,0,0),new H.Vector3(0,-$,0),new H.Vector3(0,$,0)]),T=new H.LineBasicMaterial({color:16777215,linewidth:2,depthTest:!1}),q=new H.LineSegments(K,T);this.crosshairGroup.add(q),this.scene.add(this.crosshairGroup)}else if(!Q&&this.crosshairGroup)this.scene.remove(this.crosshairGroup),this.crosshairGroup.traverse(($)=>{if($ instanceof H.LineSegments)$.geometry.dispose(),$.material.dispose()}),this.crosshairGroup=null}setViewOrientation(J){let $={front:[0,0,100],back:[0,0,-100],left:[-100,0,0],right:[100,0,0],top:[0,100,0],bottom:[0,-100,0],diagonal:[100,100,100],center:[100,50,100]},K=$[J]||$.front,T=new H.Vector3(this.printerSize.width/2,0,this.printerSize.depth/2);if(this.lastGeometryBounds){let q=new H.Vector3(this.printerSize.width/2,0,this.printerSize.depth/2),Z=new H.Vector3(...this.lastGeometryBounds.min).add(q),U=new H.Vector3(...this.lastGeometryBounds.max).add(q);T=new H.Vector3().addVectors(Z,U).multiplyScalar(0.5)}this.camera.position.set(T.x+K[0],T.y+K[1],T.z+K[2]),this.camera.lookAt(T),this.controls.target.copy(T),this.controls.update()}setProjectionMode(J){if(this.isPerspective===(J==="perspective"))return;let Q=this.camera,$=this.renderer.domElement.width/this.renderer.domElement.height;if(J==="orthographic")this.camera=new H.OrthographicCamera(-100*$/2,100*$/2,50,-50,0.1,3000),this.isPerspective=!1;else this.camera=new H.PerspectiveCamera(75,$,0.1,69420),this.isPerspective=!0;this.camera.position.copy(Q.position),this.camera.lookAt(this.controls.target),this.controls.object=this.camera,this.controls.update()}zoomIn(){if(this.camera instanceof H.PerspectiveCamera){let Q=new H.Vector3().subVectors(this.camera.position,this.controls.target);Q.multiplyScalar(0.9),this.camera.position.copy(this.controls.target).add(Q)}else{let Q=this.camera.zoom;this.camera.zoom=Math.min(Q*1.1,10),this.camera.updateProjectionMatrix()}this.controls.update()}zoomOut(){if(this.camera instanceof H.PerspectiveCamera){let Q=new H.Vector3().subVectors(this.camera.position,this.controls.target);Q.multiplyScalar(1.1),this.camera.position.copy(this.controls.target).add(Q)}else{let Q=this.camera.zoom;this.camera.zoom=Math.max(Q*0.9,0.1),this.camera.updateProjectionMatrix()}this.controls.update()}zoomToFit(){if(this.lastGeometryBounds)this.fitViewToGeometry(this.lastGeometryBounds)}getStats(){let J=this.mesh?this.mesh.geometry.index?.count||0:0;return{fps:Math.round(59.98800239952009),triangles:J,renderTime:16.67}}resize(J,Q){if(this.camera instanceof H.PerspectiveCamera)this.camera.aspect=J/Q,this.camera.updateProjectionMatrix();else if(this.camera instanceof H.OrthographicCamera){let $=J/Q,K=100;this.camera.left=-100*$/2,this.camera.right=100*$/2,this.camera.top=50,this.camera.bottom=-50,this.camera.updateProjectionMatrix()}this.renderer.setSize(J,Q),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%"}setupMouseEvents(){this.renderer.domElement.addEventListener("mousemove",(J)=>{this.onMouseMove(J)}),this.renderer.domElement.addEventListener("click",(J)=>{this.onMouseClick(J)})}onWindowResize(J){let Q=J.container,$=Q.clientWidth,K=Q.clientHeight;this.resize($,K)}updatePrinterSize(J){if(this.printerSize=J,this.gridHelper)this.scene.remove(this.gridHelper);if(this.gridHelper=new H.GridHelper(Math.max(J.width,J.depth),20,4408131,2631720),this.gridHelper.name="grid",this.gridHelper.position.set(J.width/2,0,J.depth/2),this.scene.add(this.gridHelper),this.axisHelper)this.axisHelper.position.set(J.width/2,0,J.depth/2);if(this.addBuildVolumeBox(J),this.mesh)this.mesh.position.set(J.width/2,0,J.depth/2);this.geometryObjects.forEach((Z)=>{Z.position.set(J.width/2,0,J.depth/2)});let Q=J.width/2,$=J.height/2,K=J.depth/2,q=Math.max(J.width,J.depth,J.height)*1.5;this.camera.position.set(Q+q*0.7,$+q*0.7,K+q),this.camera.lookAt(Q,$,K),this.controls.target.set(Q,$,K),this.controls.update()}getPrinterSize(){return{...this.printerSize}}dispose(){if(this.animationId!==null)cancelAnimationFrame(this.animationId);if(this.mesh)this.mesh.geometry.dispose(),this.mesh.material.dispose();this.renderer.dispose(),this.renderer.domElement.remove()}};function b2({geometry:J,printerSize:Q}){let $=q1(null),K=q1(null),{setSceneManager:T}=o1(),[q,Z]=H1([]),[U,Y]=H1(null);return T1(()=>{if(!$.current)return;let W={container:$.current,width:$.current.clientWidth,height:$.current.clientHeight,printerSize:Q?{width:Q.width,depth:Q.depth,height:Q.height,name:`${Q.manufacturer} ${Q.name}`}:void 0};return K.current=new R2(W),T(K.current),()=>{if(K.current)K.current.dispose(),K.current=null,T(null)}},[T,Q]),T1(()=>{if(K.current&&Q)K.current.updatePrinterSize({width:Q.width,depth:Q.depth,height:Q.height,name:`${Q.manufacturer} ${Q.name}`})},[Q]),T1(()=>{try{if(J&&K.current&&J.vertices&&J.indices&&J.bounds)K.current.renderGeometry(J),K.current.setHoverCallback((W)=>{Y(W),console.log("Hovered object:",W)}),K.current.setSelectCallback((W)=>{Z(W),console.log("Selected objects:",W)})}catch(W){console.error("Failed to render geometry:",W)}},[J]),T1(()=>{if(!$.current||!K.current)return;let W,I=new ResizeObserver(()=>{if(!$.current||!K.current)return;clearTimeout(W),W=setTimeout(()=>{if(!$.current||!K.current)return;let v=$.current.clientWidth,A=$.current.clientHeight;K.current.resize(v,A)},16)});return I.observe($.current),()=>{clearTimeout(W),I.disconnect()}},[]),B("div",{ref:$,className:"w-full h-full bg-[#303030]",style:{position:"relative"},children:[X(F2,{geometry:J}),(U||q.length>0)&&B("div",{className:"absolute top-4 left-4 bg-[#1D1D1D] border border-[#4772B3] rounded p-2 text-white text-sm z-10",children:[U&&B("div",{className:"flex items-center gap-2 mb-1",children:[X("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),B("span",{children:["Hover: ",U]})]}),q.length>0&&B("div",{className:"flex items-center gap-2",children:[X("span",{className:"w-2 h-2 bg-cyan-400 rounded-full"}),B("span",{children:["Selected: ",q.length," object",q.length!==1?"s":""]})]})]}),B("div",{className:"absolute top-4 right-4 flex gap-2 z-10",children:[X("button",{onClick:()=>{K.current?.clearHighlighting(),Z([]),Y(null)},className:"px-3 py-1 bg-[#4772B3] hover:bg-[#5882C3] text-white text-sm rounded transition-colors",children:"Clear Selection"}),X("button",{onClick:()=>K.current?.resetView(),className:"px-3 py-1 bg-[#4772B3] hover:bg-[#5882C3] text-white text-sm rounded transition-colors",children:"Reset View"})]})]})}function t1({geometry:J,printerSize:Q}){return X(b2,{geometry:J,printerSize:Q})}import{jsxDEV as V}from"react/jsx-dev-runtime";function _2(){let[J,Q]=o(null),[$,K]=o(null),[T,q]=o(!1),[Z,U]=o(`// Welcome to moicad
// Write OpenSCAD or JavaScript code

cube(20);
`),[Y,W]=o("openscad"),I=y2(async()=>{q(!0),K(null);try{let A=await(await fetch("/api/evaluate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:Z,language:Y})})).json();if(A.success&&A.geometry)Q(A.geometry),K(null);else{let M=A.errors?.map((u)=>u.message).join(`
`)||"Evaluation failed";K(M),Q(null)}}catch(v){K(`Network error: ${v instanceof Error?v.message:"Unknown error"}`),Q(null)}finally{q(!1)}},[Z,Y]);return V("div",{style:{display:"flex",flexDirection:"column",height:"100vh",background:"#0f172a",color:"#f1f5f9"},children:[V("div",{style:{height:"48px",background:"#1e293b",borderBottom:"1px solid #334155",display:"flex",alignItems:"center",padding:"0 1rem",gap:"1rem"},children:[V("h1",{style:{fontSize:"1.25rem",fontWeight:"bold"},children:"moicad"},void 0,!1,void 0,this),V("select",{value:Y,onChange:(v)=>W(v.target.value),style:{background:"#334155",color:"#f1f5f9",padding:"0.25rem 0.5rem",borderRadius:"0.25rem",border:"none"},children:[V("option",{value:"openscad",children:"OpenSCAD"},void 0,!1,void 0,this),V("option",{value:"javascript",children:"JavaScript"},void 0,!1,void 0,this)]},void 0,!0,void 0,this),V("div",{style:{flex:1}},void 0,!1,void 0,this),V("button",{onClick:I,disabled:T,style:{background:T?"#475569":"#3b82f6",color:"#fff",padding:"0.5rem 1rem",borderRadius:"0.25rem",border:"none",cursor:T?"not-allowed":"pointer",fontWeight:"600"},children:T?"Running...":"Run"},void 0,!1,void 0,this)]},void 0,!0,void 0,this),V("div",{style:{flex:1,display:"flex",overflow:"hidden"},children:[V("div",{style:{flex:1,display:"flex",flexDirection:"column",borderRight:"1px solid #334155"},children:[V("div",{style:{flex:1},children:V(a1,{value:Z,onChange:U,language:Y,height:"100%"},void 0,!1,void 0,this)},void 0,!1,void 0,this),$&&V("div",{style:{borderTop:"1px solid #334155"},children:V(n1,{error:$},void 0,!1,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this),V("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[V("div",{style:{flex:1},children:V(t1,{geometry:J},void 0,!1,void 0,this)},void 0,!1,void 0,this),J&&V("div",{style:{padding:"0.5rem",background:"#1e293b",borderTop:"1px solid #334155",fontSize:"0.875rem"},children:V("div",{style:{display:"flex",gap:"1rem"},children:[V("span",{children:["Vertices: ",J.stats?.vertexCount||0]},void 0,!0,void 0,this),V("span",{children:["Faces: ",J.stats?.faceCount||0]},void 0,!0,void 0,this),J.stats?.volume&&V("span",{children:["Volume: ",J.stats.volume.toFixed(2)," mm³"]},void 0,!0,void 0,this)]},void 0,!0,void 0,this)},void 0,!1,void 0,this)]},void 0,!0,void 0,this)]},void 0,!0,void 0,this)]},void 0,!0,void 0,this)}var u2=M2(document.getElementById("root"));u2.render(V(_2,{},void 0,!1,void 0,this));
